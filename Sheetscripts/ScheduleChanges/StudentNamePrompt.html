<!DOCTYPE html>
<html>
  <head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://apis.google.com/js/api.js?onload=onApiLoad"></script>
    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <script src="https://apis.google.com/js/api.js?onload=onApiLoad"></script>
    <?!= include('Stylesheet'); ?>
    <!-- The CSS package above applies Google styling to buttons and other elements. -->
  </head>
  
  <script>
    function checkValues() {
      var formData = [document.getElementById("firstname").value, document.getElementById("lastname").value];
      google.script.run.withSuccessHandler(showStudentSchedule).validateChange(formData);
    }
    
    function showStudentSchedule(validSchedule) {
      if(validSchedule.valid) {
        var x = document.getElementById('form');
        x.style.display = 'none';
        
        var html = ""; 
       
        
        var classes = validSchedule.schedule;
          var headers = classes.shift();
          console.log(headers);
        classes.sort(compareByColumnIndex(3));
       
        
        for ( var i = 0; i < classes.length; i++) {
        
        if(i == 0) {
          html += "<tr>";
          html += "<th>" + headers[0] + "</th>";
          html += "<th>" + headers[1] + "</th>";
          html += "<th>" + headers[2] + "</th>";
          html += "<th>" + headers[3] + "</th>";
          html += "</tr>"; 
        }
        
          html += "<tr>";
          html += "<td>" + classes[i][0] + "</td>";
          html += "<td>" + classes[i][1] + "</td>";
          html += "<td>" + classes[i][2] + "</td>";
          html += "<td>" + classes[i][3] + "</td>";
          html += "</tr>";
        }
        html += "</table>";
        document.getElementById("classes").innerHTML = html;
      } else {
        
      }
      
      console.log(validSchedule.valid);
      console.log(validSchedule.schedule);
    }
    
    function compareByColumnIndex(index) {
      return function(a,b){
        if (a[index] === b[index]) {
            return 0;
        }
        else {
            return (a[index] < b[index]) ? -1 : 1;
        }
      }
    }
    
  </script>
  
  <body>
    
    <div id="form">
      <label for="firstname">First Name:</label>
      <input type="text" id="firstname" required=true size="20" autofocus/><br>
      <label for="lastname">Last Name:</label>
      <input type="text" id="lastname" required=true size="20" /><br>
      <input type="button" onClick="checkValues()" value="Make Change" />
    </div>
    
    <div id="schedule">
      <table id="classes">
      </table>
    </div>
     
     <?!= include('Javascript'); ?>
  </body>
</html>


