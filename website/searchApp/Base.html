<?!= include('CSS'); ?>
<script>
  function load(html) {
    var div = document.getElementById('content');
    div.innerHTML = html;
  }
  
  /**
  * Method to be called when the Search button is pressed
  * @param json the JSON string returned when calling getJSON from the script file
  */
  function formSubmit(json){
  
    // Variables pointing to parts of the HTML document so that their contents can be edited
    var nameDiv = document.getElementById('nameDiv');
    var schedDiv = document.getElementById('schedDiv');
    var n = document.getElementById('Name').value.toString();
    
    //Parse the JSON string into an actual JSON object
    var js = JSON.parse(json);
    
    // Start of string containing html to display matched results
    var strSched = "<table><tr><th>Lunch Day</th><th>Lunch Time</th><th>Table</th></tr>";
    
    //Determine the length of the array (how many names are in the data)
    var arrayLength = js.columns.firstname.length;
    //Array of rows, one representing each entry in the sheet
    var rows = js.rows;
    for(var i=0; i<arrayLength; i++){
      var name = rows[i].firstname + " " + rows[i].lastname;
      if(name === n){
        var day = rows[i].lunchday;
        var time = rows[i].lunchtime;
        var table = "";
        switch(time){
          case "early":
            table = rows[i].lunchtable;
            break;
          case "mid":
            table = "";
            break;
          case "late":
            table = rows[i].house;
            break;
        }
        //Add each matching name to the string that will be displayed
        strSched += "<tr><td>" + day + "</td><td>" + time + "</td><td>" + table + "</td></tr>";
      }
    }
    strSched += "</table>";
    
    //Set the inner HTML of the necessary components to the proper contents
    schedDiv.innerHTML = strSched;
    nameDiv.innerHTML = "<h1>" + n + "</h1>";
    document.getElementById('loadingDiv').innerHTML = "";
  }
  
</script>

<div id="searchForm">
  <form id="nameForm">
    <input id="Name" type="text" name="fullname" />
    <input id="student" type="button" onClick="google.script.run.withSuccessHandler(formSubmit).getJSON();document.getElementById('loadingDiv').innerHTML = '<br>Loading...';" value="Search" />    
  </form>
</div>
<div id="loadingDiv"></div>
<div id="nameDiv"></div>
<div id="schedDiv"></div>


